<!DOCTYPE html>
<html lang="ru">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <title>Управление паролями</title>

</head>
<body onload="get_user()">

<div id="LoggedInContent" style="display: none;">

    <div class="container mt-5">
        <h1>Управление паролями</h1>
        <div class="container mt-5">
            <h1 style="text-align: center;">
                Добро пожаловать, <span id="catch_user" class="mt-3"></span>!
            </h1>
            <button id="unlogin" onclick="unlogin()" class="btn btn-danger float-right">Выйти</button>

            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Длина пароля:</span>
                        </div>
                        <input type="number" id="passwordLength" min="8" max="20" value="12" class="form-control">
                    </div>
                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" id="includeNumbers">
                        <label class="form-check-label" for="includeNumbers">Включить цифры</label>
                    </div>
                    <button id="generateButton" onclick="getGeneratedPassword()" class="btn btn-primary">Генерация</button>
                    <span id="generatedPassword" class="mt-3"></span>
                </div>

                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Имя сервиса:</span>
                        </div>
                        <input type="text" id="AddServiceName" placeholder="Введите имя сервиса" class="form-control">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Логин:</span>
                        </div>
                        <input type="text" id="AddLogin" placeholder="Введите логин" class="form-control">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Пароль:</span>
                        </div>
                        <input type="text" id="AddPassword" placeholder="Введите пароль" class="form-control">
                    </div>
                    <button id="addNewButton" onclick="AddLoginPassword()" class="btn btn-success">Добавить</button>
                </div>
            </div>

            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Имя сервиса:</span>
                        </div>
                        <input type="text" id="DeleteServiceName" placeholder="Введите имя сервиса" class="form-control">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Логин:</span>
                        </div>
                        <input type="text" id="DeleteLogin" placeholder="Введите логин" class="form-control">
                    </div>
                    <button id="deleteButton" onclick="DeleteLoginPassword()" class="btn btn-danger">Удалить</button>
                </div>

                <div class="col-md-6">
                    <div class="row">
                        <div class="col-auto">
                            <button id="showButton" onclick="getAllData()" class="btn btn-primary btn-block">Вывести все пароли</button>
                        </div>
                        <div class="col">
                            <span id="passwordListContainer" class="mt-3"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="NotLoggenInContent" style="display: none">
    <div class="alert alert-danger text-center mt-5">
        <h1>ACCESS DENIED</h1>
        <p>Please log in to access the content.</p>
        <a href="/" class="btn btn-primary">Go back to the main page</a>
    </div>
</div>
<script>
    const isLogged = document.cookie.includes('isLogged=true');

    if (isLogged) {
        document.getElementById('LoggedInContent').style.display = 'block'
    } else {
        document.getElementById('NotLoggenInContent').style.display = 'block'
    }

</script>
<script> async function getGeneratedPassword() {
    p_length = document.getElementById('passwordLength').value;
    include_digs = document.getElementById('includeNumbers').checked;
    const response = await fetch(window.location.href, {
        method: 'POST',
        headers: {"Accept": "application/json", "Content-Type": "application/json"},
        body: JSON.stringify({
            'action': 'GeneratePassword',
            'password_length': p_length,
            'include_digs': include_digs,
        })
    });

    const responseData = await response.json();

    const password = await responseData.password

    const generateOutput = document.getElementById('generatedPassword');

    generateOutput.textContent = password;
}</script>

<script> async function AddLoginPassword() {
    serviceName = document.getElementById('AddServiceName').value;
    login_ = document.getElementById('AddLogin').value;
    password = document.getElementById('AddPassword').value;

    if (serviceName && login_ && password) {
        const response = await fetch(window.location.href, {
            method: 'POST',
            headers: {"Accept": "application/json", "Content-Type": "application/json"},
            body: JSON.stringify({
                'user': getCookie('user'),
                'action': 'AddNewData',
                'serviceName': serviceName,
                'login': login_,
                'password': password
            })
        });

        const responseData = await response.json();
        if (responseData.added) {
            alert('added')
        }
    } else {
        alert('ENTER SOMETHING IN THE INPUT FIELD')
    }

}</script>

<script> async function DeleteLoginPassword() {
    serviceName = document.getElementById('DeleteServiceName').value;
    login_ = document.getElementById('DeleteLogin').value;

    if (serviceName && login_) {
        const response = await fetch(window.location.href, {
            method: 'POST',
            headers: {"Accept": "application/json", "Content-Type": "application/json"},
            body: JSON.stringify({
                'user': getCookie('user'),
                'action': 'DeleteData',
                'serviceName': serviceName,
                'login': login_,
            })
        });

        const responseData = await response.json();
        if (responseData.deleted) {
            alert('Deleted')
        }
    } else {
        alert('ENTER SOMETHING IN THE INPUT FIELD')
    }

}</script>

<script>
    async function getAllData() {
        user = getCookie('user')

        const response = await fetch(window.location.href, {
            method: 'POST',
            headers: {"Accept": "application/json", "Content-Type": "application/json"},
            body: JSON.stringify({
                'user': getCookie('user'),
                'action': 'getAllData',
            })
        });

        const responseData = await response.json();
        let data = responseData.data;
        data = data.replace(/\n/g, '<br>');
        element = document.getElementById('passwordListContainer');
        element.innerHTML = data;
    }
</script>
<script>function delete_cookie(name) {
    document.cookie = name + '=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
}</script>

<script>function unlogin() {
    delete_cookie('user')
    document.cookie = "isLogged=false"
    window.location.href = '/'

}</script>
<script>const getCookie = (name) => {
    return document.cookie.split('; ').reduce((r, v) => {
        const parts = v.split('=')
        return parts[0] === name ? decodeURIComponent(parts[1]) : r
    }, '')
}</script>

<script>
    function get_user() {
        elem = document.getElementById('catch_user')
        name_user = getCookie('user')
        elem.textContent = name_user
    }
</script>

</body>
</html>