<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <title>Смена пароля</title>
</head>

<body>
    <div>
        <form id="ChangeForm" class="container mt-3">
            <h4>Введите новый пароль</h4>
            <div class="row mb-3">
                <label for="pass1" class="col-sm-2 col-form-label">Пароль:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="pass1" name="pass1" required>
                </div>
            </div>
            <div class="row mb-3">
                <label for="pass2" class="col-sm-2 col-form-label">Введите пароль снова:</label>
                <div class="col-sm-10">
                    <input class="form-control" id="pass2" name="pass2" required>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Дальше</button>
        </form>
    </div>
    <div id="target-div"></div>

    <script>
        const form = document.getElementById('ChangeForm');

        form.addEventListener('submit', async (event) => {
            event.preventDefault(); // Предотвращаем стандартное поведение формы

            const password1 = document.getElementById('pass1').value;
            const password2 = document.getElementById('pass2').value;

            if (password1 !== password2) {
                alert('Passwords dont match');
            } else {
                const response = await fetch(window.location.href, {
                    method: 'POST',
                    headers: { "Accept": "application/json", "Content-Type": "application/json" },
                    body: JSON.stringify({
                        'user': getCookie('user'),
                        'password': password1 // Используем password1 вместо неопределенной переменной username
                    })
                });

                const responseData = await response.json();
                const changed = responseData.changed;

                if (changed) {
                    alert('changed');
                    window.location.href = 'main.html';
                    document.cookie = "isLogged=true; path=/";
                } else {
                    alert('Something has went wrong. Check your password.')
                }
            }
        });
    </script>

    <script>
        const getCookie = (name) => {
            return document.cookie.split('; ').reduce((r, v) => {
                const parts = v.split('=');
                return parts[0] === name ? decodeURIComponent(parts[1]) : r;
            }, '');
        }
    </script>
</body>